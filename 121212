from db: 4c935cbd-726b-482a-9625-a1976f22856e	null		MEDESTHET from file: 1006554548,2356279359,MEDESTHET,Avenue Robert Dalechamp,58,,1200,BRUXELLES,000,28-02-2024,,,, Some(a6757ed70b4472de:bc7b5beca0f0f3faa3a96ec21b617e31)] from instance [Inet(172-20-18-62.tp-ivp-tst.pod.cluster0047.non-prod.ichp.ing.net/10.219.252.11:8443,Map(instanceMetadata -> InstanceMetadata(172-20-18-62.tp-ivp-tst.pod.cluster0047.non-prod.ichp.ing.net,8443,WPR,ModeLive,InvolvedPartyAPI)))] with contents HTTP/1.1 200 OK Date: Mon, 01 Dec 2025 10:19:22 GMT Pragma: no-cache traceparent: 00-bc7b5beca0f0f3faa3a96ec21b617e31-86c9c4e04405016a-01 Content-Type: application/json Cache-Control: no-store Content-Length: 397 { "postalAddress" : { "postalAddressUsageType" : "BSN_ADR", "countryCode" : "BE", "lastUpdateUser" : "X-ING-LastUpdateUser", "lastUpdateDate" : "2025-12-01T10:19:22.348Z", "effectiveDate" : "2025-12-01T10:19:22.277Z" }, "_links" : { "self" : { "href" : "https://apis.ing.com/v5/involved-parties/d6cc5ca6-6f37-40dd-8b84-53fa322c620f/postal-addresses" } } } where r other fields??? package com.ing.datadist.api.repository; import com.ing.datadist.api.model.*; import com.ing.datadist.kafka.consumer.service.PostalAddressService; import lombok.extern.slf4j.Slf4j; import org.springframework.jdbc.core.JdbcTemplate; import org.springframework.stereotype.Repository; import java.sql.Timestamp; import java.time.Instant; @Repository @Slf4j public class AccountingDAO { private final JdbcTemplate jdbcTemplate; private final PostalAddressService postalAddressService; public AccountingDAO(JdbcTemplate jdbcTemplate, PostalAddressService postalAddressService) { this.jdbcTemplate = jdbcTemplate; this.postalAddressService = postalAddressService; } public void updateExternalIdentifier(String uuid, String externalId) { String sql = "UPDATE DD_ACCOUNT_TBL SET ORG_NUMBER = ?, UPDATED_TIME = ? WHERE DD_UUID = ?"; jdbcTemplate.update(sql, externalId, Timestamp.from(Instant.now()), uuid); log.info("Updated external ID for UUID={}", uuid); } public void updateOrganisationUnitName(String uuid, String organisationUnitName) { String sql = "UPDATE DD_ACCOUNT_TBL SET FIRST_NAME = ? WHERE DD_UUID = ?"; jdbcTemplate.update(sql, organisationUnitName, uuid); log.info(" Organisation unit name updated for UUID={}", uuid); } public void updatePostalAddress(String uuid, String street, String houseNumber, String houseNumberAddition, String postalCode, String locality, String countryCode) { String sql = "UPDATE DD_ACCOUNT_TBL SET ADDR_STREET_NAME = ?, ADDR_HOUSE_NUMBER = ?, ADDR_BOX_NUMBER = ?, ADDR_POSTAL_CODE = ?, ADDR_LOCALITY_NAME = ?, ADDR_COUNTRY_CODE = ?, UPDATED_TIME = ? WHERE DD_UUID = ?"; jdbcTemplate.update(sql, street, houseNumber, houseNumberAddition, postalCode, locality, countryCode, Timestamp.from(Instant.now()), uuid); log.info("Postal Address updated for UUID={}", uuid); } public void updateDigitalAddress(String uuid, String digitalAddress) { String sql = "UPDATE DD_ACCOUNT_TBL SET DIGITAL_ADDRESS = ?, UPDATED_TIME = ? WHERE DD_UUID = ?"; jdbcTemplate.update(sql, digitalAddress, Timestamp.from(Instant.now()), uuid); log.info("Digital Address updated for UUID={}", uuid); } public void updateHierarchy(String uuid, String parentId) { String sql = "UPDATE DD_ACCOUNT_TBL SET PARENT_ORG_UUID = ?, UPDATED_TIME = ? WHERE DD_UUID = ?"; jdbcTemplate.update(sql, parentId, Timestamp.from(Instant.now()), uuid); log.info("Hierarchy updated for UUID={}", uuid); } public void createOuAccountingTableEntry(String ddUuid,String OuName) { String eventId = "null"; String sql = "INSERT INTO DD_ACCOUNT_TBL(DD_UUID,FIRST_NAME, EVENT_ID) VALUES (?,?,?)"; jdbcTemplate.update(sql,ddUuid,OuName, eventId); log.info("Created ou account table entry for UUID={}", ddUuid); } public void insertFullOrganisationUnit(CreateInvolvedPartyResponseV5 response) { InvolvedPartiesOrganisationUnitResponse orgUnit = response.getOrganisationUnit(); String ddUuid = orgUnit.getInvolvedPartyInternalIdentifiers().get(0).getInvolvedPartyInternalIdentifierValue(); String eventId = "null"; String typeOfEntity = "ORG_UNIT"; String orgName = orgUnit.getOrganisationUnitNames().get(0).getOrganisationUnitName(); Timestamp updatedTime = Timestamp.from(Instant.now()); String sql = "INSERT INTO DD_ACCOUNT_TBL (DD_UUID, EVENT_ID, TYP_OF_ENTY, FIRST_NAME, UPDATED_TIME) VALUES (?, ?, ?, ?, ?)"; jdbcTemplate.update(sql, ddUuid, eventId, typeOfEntity, orgName, updatedTime); log.info("Inserted organisation unit record: UUID={}, EVENT_ID={}, ORG_NAME={}", ddUuid, eventId, orgName); } public void insertPostalAddress(String uuid, PostalAddressResponse adr) { Timestamp effectiveTimestamp = null; if (adr.getEffectiveDate() != null) { // Parse ISO string to Instant then to Timestamp Instant instant = Instant.parse(adr.getEffectiveDate()); effectiveTimestamp = Timestamp.from(instant); } String eventId = "null"; String sql = "INSERT INTO DD_ACCOUNT_TBL (" + "DD_UUID, EVENT_ID, ADDR_STREET_NAME, ADDR_HOUSE_NUMBER, ADDR_BOX_NUMBER, " + "ADDR_POSTAL_CODE, ADDR_COUNTRY_CODE, ADDR_LOCALITY_NAME, UPDATED_TIME" + ") VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)"; jdbcTemplate.update(sql, uuid, eventId, adr.getStreetName(), adr.getHouseNumber(), adr.getHouseNumberAddition(), adr.getPostalCode(), adr.getCountryCode(), adr.getCityName(), effectiveTimestamp != null ? effectiveTimestamp : new Timestamp(System.currentTimeMillis()) ); log.info("Postal Address inserted for UUID={}", uuid); } } package com.ing.datadist.api.service; import com.ing.datadist.api.model.CreatePostalAddressRequest; import com.ing.datadist.api.model.CreatePostalAddressResponse; import com.ing.datadist.api.model.PostalAddressResponse; import com.ing.datadist.api.repository.AccountingDAO; import lombok.extern.slf4j.Slf4j; import org.springframework.stereotype.Service; //import java.security.Timestamp; import java.sql.Timestamp; import java.time.Instant; import java.time.LocalDateTime; import java.time.ZoneId; import java.util.concurrent.ExecutionException; @Service @Slf4j public class AddressService { // private final OnePamRepository repository; private final AccountingDAO accountingDAO; public AddressService(OnePamRepository repository, AccountingDAO accountingDAO) { this.repository = repository; this.accountingDAO = accountingDAO; } public PostalAddressResponse createPostalAddress(String uuid, CreatePostalAddressRequest request) { log.info("Calling OnePAM with request: {}", request); // Call repository and get wrapped response CreatePostalAddressResponse responseWrapper = repository.createPostalAddress(uuid, request).join(); // Extract postalAddress object PostalAddressResponse postalAddress = responseWrapper.getPostalAddress(); log.info("Received postalAddress: {}", postalAddress); try { // Convert ISO 8601 string to Timestamp Timestamp effectiveTimestamp = null; if (postalAddress.getEffectiveDate() != null && !postalAddress.getEffectiveDate().isEmpty()) { Instant instant = Instant.parse(postalAddress.getEffectiveDate()); effectiveTimestamp = Timestamp.from(instant); } // Insert into DB accountingDAO.insertPostalAddress(uuid, postalAddress); log.info("Postal address inserted successfully for UUID={}", uuid); } catch (Exception e) { log.error("Failed to insert postal address for UUID={} : {}", uuid, e.getMessage(), e); throw new RuntimeException(e); } return postalAddress; } } onepam repository: public CompletableFuture<CreatePostalAddressResponse> createPostalAddress(String uuid, CreatePostalAddressRequest payload) { try { log.info("createPostalAddress request payload: {}", payload); String url = RegkeyEnum.CREATE_POSTAL_ADDRESS.resolveEndpoint(uuid); String jsonPayload = objectMapper.writeValueAsString(payload); Request request = new RichHttpRequestBuilder() .withUrl(url) .withMethod(Method.Post()) .withJsonContent(jsonPayload) .withHeader("X-ING-LastUpdateUser", "X-ING-LastUpdateUser") .build(); printRequest(request); return apiClient.apply(request) .thenApply(response -> { if (response.statusCode() >= 200 && response.statusCode() < 300) { try { // Deserialize JSON into wrapper object return objectMapper.readValue(response.contentString() , CreatePostalAddressResponse.class); } catch (Exception e) { log.error("Error parsing response: {}", e); throw new DataDistributionApiException( RegkeyEnum.CREATE_POSTAL_ADDRESS, "Failed to parse postal address response" , e.getMessage() ); } } else { log.error("Failed to create postal address. Status: {}", response.statusCode()); throw new DataDistributionApiException( RegkeyEnum.CREATE_POSTAL_ADDRESS, "Failed to create postal address", "Status: " + response.statusCode() ); } }); } catch (Exception e) { log.error("createPostalAddress API error: {}", e.getMessage()); throw new DataDistributionApiException( RegkeyEnum.CREATE_POSTAL_ADDRESS, "Failed to build request for postal address creation", e.getMessage() ); } } package com.ing.datadist.api.model; import com.fasterxml.jackson.annotation.JsonProperty; import lombok.Builder; import lombok.Data; import lombok.*; @Data @NoArgsConstructor @AllArgsConstructor @Builder @Generated public class CreatePostalAddressRequest { //    @JsonProperty("postalAddressUsageType") //    private String postalAddressUsageType; //    @JsonProperty("postalAddressUsageType") private String postalAddressUsageType = "BSN_ADR"; //    @JsonProperty("countryCode") private String countryCode = "BE"; @JsonProperty("cityName") private String cityName; @JsonProperty("streetName") private String streetName; @JsonProperty("houseNumber") private String houseNumber; @JsonProperty("houseNumberAddition") private String houseNumberAddition; @JsonProperty("postalCode") private String postalCode; //   @JsonProperty("dataSource") private String dataSource = "FOS_IT"; @JsonProperty("effectiveDate") private String effectiveDate; @JsonProperty("endDate") private String endDate; } package com.ing.datadist.api.model; import com.fasterxml.jackson.annotation.JsonProperty; import lombok.AllArgsConstructor; import lombok.Builder; import lombok.Data; import lombok.NoArgsConstructor; import java.util.Map; @Data @NoArgsConstructor @AllArgsConstructor @Builder public class CreatePostalAddressResponse { @JsonProperty("postalAddress") private PostalAddressResponse postalAddress; @JsonProperty("_links") private Map<String, Object> links; } package com.ing.datadist.api.model; import com.fasterxml.jackson.annotation.JsonProperty; import lombok.*; import java.io.Serializable; @Data @NoArgsConstructor @AllArgsConstructor @Builder @Generated public class PostalAddressResponse implements Serializable { private static final long serialVersionUID = 1L; @JsonProperty("postalAddressUsageType") private String postalAddressUsageType; @JsonProperty("countryCode") private String countryCode; @JsonProperty("countryRegionCode") private String countryRegionCode; @JsonProperty("districtName") private String districtName; @JsonProperty("cityName") private String cityName; @JsonProperty("postalCode") private String postalCode; @JsonProperty("streetName") private String streetName; @JsonProperty("houseNumber") private String houseNumber; @JsonProperty("houseNumberAddition") private String houseNumberAddition; @JsonProperty("effectiveDate") private String effectiveDate; @JsonProperty("endDate") private String endDate; }

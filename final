
    public CompletableFuture<PostalAddressResponse> createPostalAddress(String uuid, CreatePostalAddressRequest payload) {
        try {
            log.info("createPostalAddress request payload: {}", payload);
            String url = RegkeyEnum.CREATE_POSTAL_ADDRESS.resolveEndpoint(uuid);
            String jsonPayload = objectMapper.writeValueAsString(payload);
            Request request = new RichHttpRequestBuilder()
                    .withUrl(url)
                    .withMethod(Method.Post())
                    .withJsonContent(jsonPayload)
                    .withHeader("X-ING-LastUpdateUser", "X-ING-LastUpdateUser")
                    .build();
            printRequest(request);
            return apiClient.apply(request)
                    .thenApply(response -> {
                        if (response.statusCode() >= 200 && response.statusCode() < 300) {
                            log.info("createPostalAddress response: {}", response);
                            return null;
                        } else {
                            log.error("Failed to create postal address. Status: {}", response.statusCode());
                            throw new DataDistributionApiException(
                                    RegkeyEnum.CREATE_POSTAL_ADDRESS,
                                    "Failed to create postal address",
                                    "Status: " + response.statusCode()
                            );
                        }
                    });
        } catch (Exception e) {
            log.error("createPostalAddress API error: {}", e.getMessage());
            throw new DataDistributionApiException(
                    RegkeyEnum.CREATE_POSTAL_ADDRESS,
                    "Failed to build request for postal address creation",
                    e.getMessage()
            );
        }
    }
package com.ing.datadist.api.service;

import com.ing.datadist.api.model.CreatePostalAddressRequest;
import com.ing.datadist.api.model.CreatePostalAddressResponse;
import com.ing.datadist.api.model.PostalAddressResponse;
import com.ing.datadist.api.repository.AccountingDAO;
import lombok.extern.slf4j.Slf4j;
import org.springframework.stereotype.Service;

import java.util.concurrent.ExecutionException;


@Service

@Slf4j

public class AddressService {

    private final OnePamRepository repository;

    private final AccountingDAO accountingDAO;

    public AddressService(OnePamRepository repository, AccountingDAO accountingDAO) {

        this.repository = repository;

        this.accountingDAO = accountingDAO;

    }

    public PostalAddressResponse createPostalAddress(String uuid, CreatePostalAddressRequest request, String user) {

        log.info("Calling OnePAM with request: {}", request);

        // Call repository and get wrapped response

        CreatePostalAddressResponse responseWrapper = repository.createPostalAddress(uuid, request);

        // Extract the postalAddress object from wrapper

        PostalAddressResponse postalAddress = responseWrapper.getPostalAddress();

        log.info("Received postalAddress: {}", postalAddress);

        // Insert into DB (you can trim to only table-relevant fields)

        accountingDAO.insertPostalAddress(uuid, postalAddress);

        return postalAddress;

    }

}package com.ing.datadist.api.model;


import com.fasterxml.jackson.annotation.JsonProperty;
import lombok.AllArgsConstructor;
import lombok.Builder;
import lombok.Data;
import lombok.NoArgsConstructor;

import java.util.Map;

@Data

    @NoArgsConstructor

    @AllArgsConstructor

    @Builder

    public class CreatePostalAddressResponse {

        @JsonProperty("postalAddress")

        private PostalAddressResponse postalAddress;

        @JsonProperty("_links")

        private Map<String, Object> links;

    }





package com.ing.datadist.api.model;

import com.fasterxml.jackson.annotation.JsonProperty;
import lombok.*;

import java.io.Serializable;


@Data
@NoArgsConstructor
@AllArgsConstructor
@Builder
@Generated
public class PostalAddressResponse implements Serializable {
    private static final long serialVersionUID = 1L;

    @JsonProperty("postalAddressUsageType")
    private String postalAddressUsageType;

    @JsonProperty("countryCode")
    private String countryCode;

    @JsonProperty("countryRegionCode")
    private String countryRegionCode;

    @JsonProperty("districtName")
    private String districtName;

    @JsonProperty("cityName")
    private String cityName;



    @JsonProperty("postalCode")
    private String postalCode;

    @JsonProperty("streetName")
    private String streetName;

    @JsonProperty("houseNumber")
    private String houseNumber;

    @JsonProperty("houseNumberAddition")
    private String houseNumberAddition;


    @JsonProperty("effectiveDate")
    private String effectiveDate;

    @JsonProperty("endDate")
    private String endDate;
}
